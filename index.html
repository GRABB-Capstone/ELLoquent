<!DOCTYPE html>
<html ng-app="submitExample">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


		<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.string/2.3.3/underscore.string.min.js"></script>
		<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/path.js/0.8.4/path.min.js"></script>		
		<script src="//www.parsecdn.com/js/parse-1.2.19.min.js"></script>		
		<script src="//cdn.rawgit.com/Artod/baascms/master/dist/baascms-1.0.0.min.js"></script>
		<script src="//cdn.rawgit.com/Artod/baascms/master/dist/baascms-adapter-parse-1.0.0.min.js"></script>
    		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.5/angular.min.js"></script
    		
    	
    		
    		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

		<!-- jQuery library -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

		<!-- Latest compiled JavaScript -->
		<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    		
    		<script>
			Parse.initialize('XlZQi8Z0dAIDNWjBmqWmNctcEjVA3NTNSVDF2fin', 'YlBsos14dteWEK9Ug2AsA8TpNiHCuPQQbDZMQcfh');
				BaasCMS.init({
			baas: 'Parse'
		});
			
			
		</script>
		
		
		
		<script>
		$(function(){
    $('[rel="popover"]').popover({
        container: 'body',
        html: true,
        content: function () {
            var clone = $($(this).data('popover-content')).clone(true).removeClass('hide');
            return clone;
        }
    }).click(function(e) {
        e.preventDefault();
    });
});
		</script>
		
		
		
<style>
	


.mygrid-wrapper-div {
    overflow: scroll;
}
	
</style>		
		
<script>
	
	
	
$(function() {  
    var window_height = $(window).height(),
       content_height = window_height - 200;

    $('.mygrid-wrapper-div').height(content_height);
});

$( window ).resize(function() {
    var window_height = $(window).height(),
       content_height = window_height - 200;
    $('.mygrid-wrapper-div').height(content_height);
});

	
	
</script>
		
<script>
  
  angular.module('submitExample', [])
    .controller('ExampleController', ['$scope', function($scope) {
      $scope.list = [];
      $scope.books =["one","two"];
      $scope.data;
      $scope.currentBook;
      $scope.loggedIn = false;
      $scope.selectedBook = {title:"No Book Selected",
						author:"N/A",
						grade:"N/A",
						subject:"N/A",
						url:"N/A"};
      $scope.selectedBook.title = "No Book Selected";
      $scope.fixedBooks = [];
      $scope.userBooks = [];
      $scope.leader=false;
      $scope.name;
      $scope.word;
      $scope.grades = ["Any","K","1","2","3","4","5","6"];
      $scope.gradesPick = ["K","1","2","3","4","5","6"];
      $scope.subjects = ["Any","Language Arts","Social Studies","Math","Science"];
      $scope.subjectsPick = ["Language Arts","Social Studies","Math","Science"];
      $scope.fileName;
      $scope.wordList  = [];
      $scope.grade;
      $scope.user;
      $scope.friends = [];
      $scope.resetFilter = function(){
	 $scope.filterSubjects = "Any";
      	 $scope.filterGrades = "Any";
      	 $scope.filterBooks();
      }
      
      $scope.filterBooks = function(){
      	var Book = Parse.Object.extend("Book");
	var query = new Parse.Query(Book);
	if($scope.filterSubjects != "Any")
		query.equalTo("subject",$scope.filterSubjects);
	if($scope.filterGrades != "Any")	
		query.equalTo("grade",$scope.filterGrades);
	query.find({
  	success: function(results) {
		$scope.books = results;
		$scope.fixedBooks = [];
		for (var i = 0; i < results.length; i++) {
			$scope.fixedBooks.push({title:results[i].get("title"),
						author:results[i].get("author"),
						grade:results[i].get("grade"),
						subject:results[i].get("subject"),
						url:results[i].get("bookPhoto").url()});
			
		}
		$scope.$apply();

  	},
  	error: function(error) {
		alert("Error: " + error.code + " " + error.message);
	}
	});
      }
      $scope.updateWords = function(){
		var Book= Parse.Object.extend("Book");
		var query = new Parse.Query(Book);
		query.equalTo("title", $scope.selectedBook.title);
		query.find({
  		success: function(results) {
  			$scope.allBooks = results;
  			$scope.wordList = results[0].get("words");
  			$scope.currentBook = results[0];
  			$scope.$apply();
  		
  		},
  		error: function(error) {
			alert("Error: " + error.code + " " + error.message);
		}
		});
		
	}
	$scope.updateImages = function(){
		var Image= Parse.Object.extend("Image");
		var query = new Parse.Query(Image);
		query.equalTo("book", $scope.selectedBook.title);
		query.find({
  		success: function(results) {
  			$scope.imageList =[];
  			for (var i = 0; i < results.length; i++) {
				$scope.imageList.push({name:results[i].get("name"),
							id:results[i].id,
							url:results[i].get("image").url()});

			}
			
			$scope.$apply();

  		},
  		error: function(error) {
			alert("Error: " + error.code + " " + error.message);
		}
		});

	}
      $scope.updateBooks = function(){
	var Book = Parse.Object.extend("Book");
	var query = new Parse.Query(Book);
	query.find({
  	success: function(results) {
		$scope.allBooks = results;
		$scope.fixedBooks = [];
		for (var i = 0; i < results.length; i++) {
			$scope.fixedBooks.push({title:results[i].get("title"),
						author:results[i].get("author"),
						grade:results[i].get("grade"),
						subject:results[i].get("subject"),
						url:results[i].get("bookPhoto").url()});
			
		}
		$scope.$apply();

  	},
  	error: function(error) {
		alert("Error: " + error.code + " " + error.message);
	}
	});
      }
      
      $scope.addImage = function(){
      	
      	var Book= Parse.Object.extend("Book");
	var query = new Parse.Query(Book);
	query.equalTo("title", $scope.selectedBook.title);
	query.find({
  	success: function(results) {
  		var imageUploadControl = $("#image")[0];
      		var parseImage;
      		$scope.imageName = $scope.image.slice(12);
      		if (imageUploadControl.files.length > 0) {
		  	var image = imageUploadControl.files[0];
   		 	var imageName = $scope.imageName;
   		 	parseImage = new Parse.File(imageName, image);
   		 	alert("Uploaded Image: " + parseImage);
      		}	
  		var Image= Parse.Object.extend("Image");
		var image= new Image();
  		image.set("image", parseImage);
  		image.set("name",imageName);
  		image.set("book",$scope.selectedBook.title);
  		image.save();
  		alert("added image");
  		
  		results[0].addUnique("images",imageName);
  		results[0].save();
  		$scope.image = "";
  		$scope.$apply();
  		


  	

  	},
  	error: function(error) {
		alert("Error: " + error.code + " " + error.message);
	}
		
		
       	
      });
       

      }
      $scope.addWord = function(){
      		if ($scope.wordList.includes($scope.word)){
      			alert("Word Already Exists");
      		}
      		else
      	  		$scope.wordList.push($scope.word);
      	  		
							var Book= Parse.Object.extend("Book");
							var query = new Parse.Query(Book);
							query.equalTo("title", $scope.selectedBook.title);
							query.find({
  						success: function(results) {
  							results[0].addUnique("words",$scope.word);
  							results[0].save();
  							$scope.word = "";
  							$scope.$apply();
  						},
  						error: function(error) {
								alert("Error: " + error.code + " " + error.message);
							}
					});
	}
	$scope.tryLogin = function(){
		if ($scope.username == "bronan")
			$scope.loggedIn = true;
	
  	}
  	$scope.quickLogin = function(){

		$scope.loggedIn = true;
	
  	}
  	$scope.login = function(){
  	var user = Parse.User.logIn($scope.username, $scope.password, {
  		success: function(user) {
			$scope.loggedIn = true;
			$scope.currentUser = user;
			alert(user.get("username") + " logged in");
			$scope.$apply();
   
		},
		error: function(user, error) {
    			// The login failed. Check error to see why.
    			alert("Incorrect Username or Password");
  		}
		});	
  	}
  	$scope.addToUser = function(title){
  		
  		$scope.currentUser.addUnique("books",title);
  		$scope.currentUser.save();
  		alert("Added book to user");
  	}
  
	$scope.updateUserBooks = function(){
		$scope.userBooks = [];
		var tempBooks = $scope.currentUser.get("books");
		
	
		
		
		for (var i = 0; i < tempBooks.length; i++) {
			
			
			for (var j = 0; j<$scope.fixedBooks.length;j++)
			
			if($scope.fixedBooks[j].title ==tempBooks[i]){
				$scope.userBooks.push($scope.fixedBooks[j])
			}
				
		
		}
	//	alert("len: " + $scope.userBooks.length);
		

      
		
		
		
	}

  	
  	$scope.test = function (x){
  		alert("test" + x);
  	}
  	$scope.trig = function (selBook){
  		

  		$scope.selectedBook = selBook;
  		$scope.updateWords();
  		$scope.updateImages();
					
  		activaTab('menu1');
  	}
  	$scope.jumpToBrowse = function (){
  		

  		$scope.updateBooks();
					
  		activaTab('content');
  	}
  	$scope.jumpToEdit = function (bookName){
  		
		
		//$scope.selectedBook =
		
		var Book = Parse.Object.extend("Book");
		var query = new Parse.Query(Book);
		query.equalTo("title", bookName);
		query.find({
	 	success: function(results) {
			$scope.selectedBook = results[0];
			$scope.$apply();

  		},
  		error: function(error) {
			alert("Error: " + error.code + " " + error.message);
		}
		});
		
		
  		$scope.updateWords();
  		$scope.updateImages();
		
		
	
			
  		activaTab('menu1');
  	}
  
  	
		
		
		
	$scope.activaTab = function activaTab(tab){
    		$('.nav-tabs a[href="#' + tab + '"]').tab('show');
		
		
	}
	$scope.removeFromUser = function(title){
      	
      	$scope.currentUser.remove("books",title);
      	$scope.currentUser.save();
      	$scope.updateUserBooks();
      	alert("removed book from user: " + title);
      }
	
      $scope.removeWord = function(word){
      	
      	$scope.currentBook.remove("words",word);
      	$scope.currentBook.save();
      	$scope.updateWords();
      	alert("removed word: " + word);
      }
      $scope.removeBook = function(bookTitle){
      	
     	var Book = Parse.Object.extend("Book");
	var query = new Parse.Query(Book);
	query.equalTo("title", bookTitle);
	query.find({
  	success: function(results) {
		results[0].destroy({
	 	success: function(myObject) {
		  // The object was deleted from the Parse Cloud.
		  alert("removed book: " + bookTitle);
		  if (bookTitle == $scope.selectedBook.title){
		  	$scope.wordList = [];
			$scope.showmeWords=false;
			$scope.selectedBook = "";
		  }
		  $scope.updateBooks();

  		},
  		error: function(myObject, error) {
    		// The delete failed.
    		// error is a Parse.Error with an error code and message.
    				  alert("error removing book");

  		}
	});
		
		

  	},
  	error: function(error) {
		alert("Error: " + error.code + " " + error.message);
	}
	});

     	
      }
      $scope.removeImage = function(imageID){
      	
      	var Image = Parse.Object.extend("Image");
	var query = new Parse.Query(Image);
	query.get(imageID, {
  	success: function(foundImage) {
	 // The object was retrieved successfully.

	 foundImage.destroy({
	 success: function(myObject) {
		  // The object was deleted from the Parse Cloud.
		  alert("removed image");
		  $scope.updateImages();
  	},
  	error: function(myObject, error) {
    		// The delete failed.
    		// error is a Parse.Error with an error code and message.
    		alert("error removing image");

  		}
	});
	 
	 },
  	error: function(object, error) {
    // The object was not retrieved successfully.
    // error is a Parse.Error with an error code and message.
  	}
	});
      	
      	
      
      }
      $scope.addBook = function() {
      	
      	
      	for (var i = 0; i < $scope.fixedBooks.length; i++) {
		if ($scope.fixedBooks[i].title == $scope.name)
			found = 1;
	}
      	
      	if (found){
      		alert("Book Already Exists, Upload Stopped");
      	}
      	else{
      	
      	var fileUploadControl = $("#pic")[0];
      	var parseFile;
      	$scope.fileName = $scope.cover.slice(12);
      	if (fileUploadControl.files.length > 0) {
	   var file = fileUploadControl.files[0];
   	   var name = $scope.fileName;
   	   parseFile = new Parse.File(name, file);
   	   alert("Uploaded: " + name);
      	}
      	
      	var found = 0;
      	
      	var Book= Parse.Object.extend("Book");
      	//var acl= new Parse.ACL();
	var book= new Book();
	//var user= new Parse.User();
	book.set("title",$scope.name);
	book.set("author",$scope.author);
	book.set("grade", $scope.pickedGrade);
	book.set("subject",$scope.pickedSubject);
	book.set("bookPhoto", parseFile);
	book.set("words",[]);
	book.set("user",$scope.user);
	

	var bookName = $scope.name;
	
	//user.setUsername("username", $scope.user);
	//acl.setPublicReadAccess(false);
	//acl.setPublicWriteAccess(false);
	//acl.setReadAccess(user, true);
	//acl.setWriteAccess(user, true);
	//window.alert(user.getUsername());
	//book.setACL(acl);
	book.save();
	
	
	//$scope.fixedBooks.push({title:$scope.name,author:$scope.author,grade:$scope.grade});

	$scope.name = "";
	$scope.author = "";
	$scope.grade = "";
	$scope.pickedGrade ="";
	$scope.pickedSubject = "";
	$scope.cover = "";
	$scope.user = "";
	$scope.updateBooks();
	
	
				var selBook = 	{title:book.get("title"),
						author:book.get("author"),
						grade:book.get("grade"),
						subject:book.get("subject"),
						url:book.get("bookPhoto").url()}
	//$scope.$apply();
	
	$scope.trig(selBook);

	
      	}
      };
    }]);
       
       
// and fire it after definition
</script>
<script>
	
function activaTab(tab){
    $('.nav-tabs a[href="#' + tab + '"]').tab('show');
};




</script>


</head>

<body>







<div ng-controller="ExampleController">

	<div class="container">
		<center><img src="images/elloquent_whitespace.png" alt="hi" style="height:128px" class="inline"/></center>
	</div>

	<div class = "container" ng-hide="loggedIn == true">
        <input class="form-control"  type="text"  placeholder="Example: myUsername " ng-model="username" />
        <input class="form-control"  type="text"  placeholder="Example: myPassword " ng-model="password" />
	<input class="btn btn-primary btn-block" type="submit" id="passCode" value="Log In" ng-click="login()" ng-disabled = "!username || !password" />
	</div>

	<div ng-show="loggedIn == true" data-ng-init="updateBooks()">

		<div class="container">
  		<h2>Navigation Bar</h2>
		<ul class="nav nav-tabs">
    			<li class="active"><a data-toggle="tab" href="#content" ng-click="updateBooks()">Browse Content</a></li>
    			<li><a data-toggle="tab" href="#home" ng-click="updateBooks()">Add Books</a></li>
		 	<li><a data-toggle="tab" href="#menu1">Edit Book</a></li>
    			<li><a data-toggle="tab" href="#menu2" ng-click = "updateUserBooks()">My Books</a></li>
  		</ul>


  		<div class="tab-content">
  		<div id="content" class="tab-pane fade in active">
      		<h3>Browse Content </h3>
      		
      		
      	
      		<div class = "container">
      		<div class = "row">
      			<div class="col-sm-4">
      				
      				
      				<form>
  				<div class="form-group">
    					<label for="repeatSelect"> Filter by Grade: </label>
    					<select class="form-control" ng-model="filterGrades" ng-options="grade for grade in grades" ng-init="filterGrades = grades[0]">

    					</select>
    					
    					<label for="repeatSelect"> Filter by Subject: </label>
    					<select class="form-control" ng-model="filterSubjects" ng-options="subject for subject in subjects" ng-init="filterSubjects = subjects[0]">

    					</select>
  				</div>
  				<button type="submit" class="btn" id="filter" value="filter" ng-click = "filterBooks()" >Filter!</button>
  				<button type="submit" class="btn" id="resetFilter" value="restFilter" ng-click = "resetFilter()" >Reset Filter</button>
				<p></p>
    				<p></p>
    		
				</form>
      				
      				
      				
      				
      			
    			</div>
		</div>
		
		</div>
    	
    		
    		
    		
    		<div class = "row">
      			<div class="container">
      				<p></p>
    				<p></p>
    			<div class="mygrid-wrapper-div">

  				<table class="table table-hover">
  				
    				<tr>
    					
      					<th>Title</th>
      					<th>Author</th>
      					<th>Cover</th>
      					<th>Grade</th>
      					<th>Subject</th>
      				
      					<th>Edit</th>
      					<th>Add to User</th>
      					<th>Remove</th>
					 </tr>
    				<tr ng-repeat="book in allBooks">
      					<td>{{book.get("title")}}</td>
      					<td>{{book.get("author")}}</td>
 
      					
      					<td><img ng-src="{{book.get('bookPhoto').url()}}" style="height:128px;" />	</td>
      					<td>{{book.get("grade")}}</td>
      					<td>{{book.get("subject")}}</td>	
      						
      				
      				
      				
      					<td>
      	  <button type="submit" class="btn" id="addWord" value="jumpWord" ng-click="trig(book)" >Edit</button>

      					</td>
      					
      					<td>
      						
           <button type="submit" class="btn" id="addToUser" ng-click="addToUser(book.title)">Add to User</button>
						
      						
      					</td>
      					<td>
      						
      					<button type="submit" class="btn" id="removeBook"  ng-click="removeBook(book.title)" >X</button>
	
      						
      					</td>
      					
      					

      					
			 		</tr>
  				</table>
			</div>
			</div>
		</div>	
			
		</div>
		
	
		
    		<div id="home" class="tab-pane fade">

      
      
		 	<div class= "container">
	
		 		<div class = "row">
		 		 <div class = "col-md-12">
		 		<h3>Add a Book</h3>
      				<h5>Book Title:</h5>
      				<input class="form-control"  type="text"  placeholder="Example: Harry Potter" ng-model="name" name="name2" />
      				<h5>Author:</h5>
      				<input class="form-control"  type="text"  placeholder="Example: J.K. Rowling" ng-model="author" />
    				<h5>Select Grade Level:</h5>
    				
    		
    				<select class="form-control" ng-model="pickedGrade" ng-options="grade for grade in gradesPick">
    					<option value="">Select one</option>

    				</select>
    				
    				
      				<h5>Select Subject:</h5>
          			<select class="form-control" ng-model="pickedSubject" ng-options="subject for subject in subjectsPick">
    					<option value="">Select one</option>
      				</select>
      				
      				<h5>Username:</h5>
    			 	<input class="form-control"  type="text"  placeholder="Example: bronan" ng-model="user"/>
      				<h5>Book Cover:</h5>
      				<input type="file" id="pic" ng-model="cover"/>

      				<p></p>
      				<input class="btn btn-primary btn-block" type="submit" id="submit" value="Submit" ng-click="addBook()" ng-disabled="!name || !author || !pickedGrade || !user || !cover || !pickedSubject"/>
      

				
				</div >


   	 
      				</div>
      
    			</div>
    		</div>
    		
    		
    		<div id="menu1" class="tab-pane fade">
      	<div class = "container">
      		
      	<div class = "row">
      		<div class = col-md-4>
      			<h3>Add Content to Book </h3>
      			
      			
      			
      			
      			
      			
      			<h3>{{selectedBook.title}}</h3>
      			
      			
      			
      			
      			
      			
      			<h5>Add Word:</h5>
		   	<input class="form-control"  type="text"  placeholder="Example: Technology" ng-model="word"/>
		     	<input class="btn btn-primary btn-block" type="submit" id="addWord" value="Add Word" ng-click="addWord()" ng-disabled="!word || selectedBook.title == 'No Book Selected'"/>
      			
      			<h5>Add Image:</h5>
		     	 <input  type="file" id="image" ng-model="image"/>
		     	 <input class="btn btn-primary btn-block" type="submit" id="addImage" value="Add Image" ng-click="addImage();updateImages();" ng-disabled="!image"/>
		     	 	
      			
      			 <input class="btn btn-primary btn-block" type="submit" id="backToBrowse" value="Back to Browse" ng-click="jumpToBrowse();"/>

      		</div>
      		<div class = "col-md-4">
      			<h3>Current Words </h3>
      			<div class="mygrid-wrapper-div">
  					<table class="table table-hover">
    					<tr>
      						<th>Words</th>
      						<th>Remove</th>
		 			</tr>
		 			
    					<tr ng-repeat="word in wordList track by $index">
      						<td>{{word}}</td>
      						<td>      	
      						<button type="submit" class="btn" id="removeWord"  ng-click="removeWord(word)" >X</button>
						</td>
    					</tr>
    					</table>
    				</div>
    				
    				
      		</div>
      		<div class = "col-md-4">
      			<h3>Current Images</h3>
      			<div class = "mygrid-wrapper-div">
  					<table class="table table-hover">
    					<tr>
      						<th>Image</th>
      						<th>Remove</th>
		 					</tr>
    					<tr ng-repeat="image in imageList track by $index" >
    						<td><img ng-src="{{image.url}}" style="height:128px;" />	</td>
    						<td>
    							<button type="submit" class="btn" id="removeImage"  ng-click="removeImage(image.id)" >X</button>
						</td>
    					</tr>
  					</table>


				</div>
      		</div>
      		
      	</div>
      
      			
      	
	 </div>
	 </div>
	 		
	 	
    		
    		<div id="menu2" class="tab-pane fade">
      		<h3>Your Books!</h3>
      		
      		
      		
      		
      		
      		
      		
      		
      			<div class="col-sm-4">
      				
      				
      				<form>
  				<div class="form-group">
    					<label for="repeatSelect"> Filter by Grade: </label>
    					<select class="form-control" ng-model="filterGrades" ng-options="grade for grade in grades" ng-init="filterGrades = grades[0]">

    					</select>
    					
    					<label for="repeatSelect"> Filter by Subject: </label>
    					<select class="form-control" ng-model="filterSubjects" ng-options="subject for subject in subjects" ng-init="filterSubjects = subjects[0]">

    					</select>
  				</div>
  				<button type="submit" class="btn" id="filter" value="filter" ng-click = "filterBooks()" >Filter!</button>
  				<button type="submit" class="btn" id="resetFilter" value="restFilter" ng-click = "resetFilter()" >Reset Filter</button>
				<p></p>
    				<p></p>
    		
				</form>
      				
      				
      				
      				
      			
    			</div>

    	
    		
    		
    		
    		
    		
    		
      			<div class="container"  >
      				<p></p>
    				<p></p>
  				<table class="table table-hover">
  				
    				<tr>
    					
      					<th>Title</th>
      					<th>Author</th>
      					<th>Cover</th>
      					<th>Grade</th>
      					<th>Subject</th>
      				
      					<th>Edit</th>
      					<th>Add to User</th>
      					<th>Remove Book</th>
					 </tr>
    				<tr ng-repeat="book in userBooks">
      					<td>{{book.title}}</td>
      					<td>{{book.author}}</td>
 
      					
      					<td><img ng-src="{{book.url}}" style="height:128px;" />	</td>
      					<td>{{book.grade}}</td>
      					<td>{{book.subject}}</td>	
      						
      				
      				
      				
      					<td>
      	  <button type="submit" class="btn" id="addWord" value="jumpWord" ng-click="trig(book)" >Edit</button>

      					</td>
      					
      					<td>
      						
           <button type="submit" class="btn" id="addToUser" ng-click="removeFromUser(book.title)" >Remove from User</button>
						
      						
      					</td>
      					<td>
      						
      					<button type="submit" class="btn" id="removeBook"  ng-click="removeBook(book.title)" >Remove Book</button>
	
      						
      					</td>
      					
      					

      					
			 		</tr>
  				</table>
			</div>
      		
      	
      	
      	
      	
      	
      	
      				
		</div>
    		
    		

    
   		</div>

		</div>
	</div>
</div>





</body>
</html>
