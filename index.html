<!DOCTYPE html>
<html ng-app="submitExample">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


		<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.string/2.3.3/underscore.string.min.js"></script>
		<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/path.js/0.8.4/path.min.js"></script>		
		<script src="//www.parsecdn.com/js/parse-1.2.19.min.js"></script>		
		<script src="//cdn.rawgit.com/Artod/baascms/master/dist/baascms-1.0.0.min.js"></script>
		<script src="//cdn.rawgit.com/Artod/baascms/master/dist/baascms-adapter-parse-1.0.0.min.js"></script>
    		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.5/angular.min.js"></script
    		
    	
    		
    		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

		<!-- jQuery library -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

		<!-- Latest compiled JavaScript -->
		<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    		
    		<script>
			Parse.initialize('XlZQi8Z0dAIDNWjBmqWmNctcEjVA3NTNSVDF2fin', 'YlBsos14dteWEK9Ug2AsA8TpNiHCuPQQbDZMQcfh');
				BaasCMS.init({
			baas: 'Parse'
		});
			
			
		</script>
		
		
		
		<script>
		$(function(){
    $('[rel="popover"]').popover({
        container: 'body',
        html: true,
        content: function () {
            var clone = $($(this).data('popover-content')).clone(true).removeClass('hide');
            return clone;
        }
    }).click(function(e) {
        e.preventDefault();
    });
});
		</script>
		
<script>
  
  angular.module('submitExample', [])
    .controller('ExampleController', ['$scope', function($scope) {
      $scope.list = [];
      $scope.books =["one","two"];
      $scope.data;
      $scope.currentBook;
      $scope.loggedIn = false;
      $scope.selectedBook = "";
      $scope.fixedBooks = [];
      $scope.leader=false;
      $scope.name;
      $scope.word;
      $scope.grades = ["Any","K","1","2","3","4","5","6"];
      $scope.gradesPick = ["K","1","2","3","4","5","6"];
      $scope.subjects = ["Any","Language Arts","Social Studies","Math","Science"];
      $scope.subjectsPick = ["Language Arts","Social Studies","Math","Science"];
      $scope.fileName;
      $scope.wordList  = [];
      $scope.grade;
      $scope.user;
      $scope.friends = [];
      $scope.resetFilter = function(){
	 $scope.filterSubjects = "Any";
      	 $scope.filterGrades = "Any";
      }
      
      $scope.filterBooks = function(){
      	var Book = Parse.Object.extend("Book");
	var query = new Parse.Query(Book);
	if($scope.filterSubjects != "Any")
		query.equalTo("subject",$scope.filterSubjects);
	if($scope.filterGrades != "Any")	
		query.equalTo("grade",$scope.filterGrades);
	query.find({
  	success: function(results) {
		$scope.books = results;
		$scope.fixedBooks = [];
		for (var i = 0; i < results.length; i++) {
			$scope.fixedBooks.push({title:results[i].get("title"),
						author:results[i].get("author"),
						grade:results[i].get("grade"),
						subject:results[i].get("subject"),
						url:results[i].get("bookPhoto").url()});
			
		}
		$scope.$apply();

  	},
  	error: function(error) {
		alert("Error: " + error.code + " " + error.message);
	}
	});
      }
      $scope.updateWords = function(){
		var Book= Parse.Object.extend("Book");
		var query = new Parse.Query(Book);
		query.equalTo("title", $scope.selectedBook.title);
		query.find({
  		success: function(results) {
  			$scope.wordList = results[0].get("words");
  			$scope.currentBook = results[0];
  			$scope.$apply();
  		
  		},
  		error: function(error) {
			alert("Error: " + error.code + " " + error.message);
		}
		});
		
	}
	$scope.updateImages = function(){
		var Image= Parse.Object.extend("Image");
		var query = new Parse.Query(Image);
		query.equalTo("book", $scope.selectedBook.title);
		query.find({
  		success: function(results) {
  			$scope.imageList =[];
  			for (var i = 0; i < results.length; i++) {
				$scope.imageList.push({name:results[i].get("name"),
							id:results[i].id,
							url:results[i].get("image").url()});
			}
			
			$scope.$apply();

  		},
  		error: function(error) {
			alert("Error: " + error.code + " " + error.message);
		}
		});

	}
      $scope.updateBooks = function(){
	var Book = Parse.Object.extend("Book");
	var query = new Parse.Query(Book);
	query.find({
  	success: function(results) {
		$scope.books = results;
		$scope.fixedBooks = [];
		for (var i = 0; i < results.length; i++) {
			$scope.fixedBooks.push({title:results[i].get("title"),
						author:results[i].get("author"),
						grade:results[i].get("grade"),
						subject:results[i].get("subject"),
						url:results[i].get("bookPhoto").url()});
			
		}
		$scope.$apply();

  	},
  	error: function(error) {
		alert("Error: " + error.code + " " + error.message);
	}
	});
      }
      $scope.addImage = function(){
      	
      	var Book= Parse.Object.extend("Book");
	var query = new Parse.Query(Book);
	query.equalTo("title", $scope.selectedBook.title);
	query.find({
  	success: function(results) {
  		var imageUploadControl = $("#image")[0];
      		var parseImage;
      		$scope.imageName = $scope.image.slice(12);
      		if (imageUploadControl.files.length > 0) {
		  	var image = imageUploadControl.files[0];
   		 	var imageName = $scope.imageName;
   		 	parseImage = new Parse.File(imageName, image);
   		 	alert("Uploaded Image: " + parseImage);
      		}	
  		var Image= Parse.Object.extend("Image");
		var image= new Image();
  		image.set("image", parseImage);
  		image.set("name",imageName);
  		image.set("book",$scope.selectedBook.title);
  		image.save();
  		
  		results[0].addUnique("images",imageName);
  		results[0].save();
  	

  	},
  	error: function(error) {
		alert("Error: " + error.code + " " + error.message);
	}
		
		
       	
      });
      }
      $scope.addWord = function(){
      		if ($scope.wordList.includes($scope.word)){
      			alert("Word Already Exists");
      		}
      		else
      	  		$scope.wordList.push($scope.word);
							var Book= Parse.Object.extend("Book");
							var query = new Parse.Query(Book);
							query.equalTo("title", $scope.selectedBook.title);
							query.find({
  						success: function(results) {
  							results[0].addUnique("words",$scope.word);
  							results[0].save();
  						},
  						error: function(error) {
								alert("Error: " + error.code + " " + error.message);
							}
					});
	}
	$scope.login = function(){
		if ($scope.username == "bronan")
			$scope.loggedIn = true;
	
  	}
  	$scope.quickLogin = function(){

		$scope.loggedIn = true;
	
  	}
  	$scope.tryLogin = function(){
  	var user = Parse.User.logIn($scope.username, $scope.password, {
  		success: function(user) {
			$scope.login();
   
		}
		});	
  	}
  	$scope.test = function (x){
  		alert("test" + x);
  	}
  	$scope.trig = function (selBook){
  		

  		$scope.selectedBook = selBook;
  		$scope.updateWords();
					
  		activaTab('menu1');
  	}
  	$scope.trig2 = function (selBook){
  		

  		$scope.selectedBook = selBook;
  		$scope.updateImages();
					
  		activaTab('menu2');
  	}
  	
		
		
		
	$scope.activaTab = function activaTab(tab){
    		$('.nav-tabs a[href="#' + tab + '"]').tab('show');
		
		
	}	
	
      $scope.removeWord = function(word){
      	
      	$scope.currentBook.remove("words",word);
      	$scope.currentBook.save();
      	$scope.updateWords();
      	alert("removed word: " + word);
      }
      $scope.removeBook = function(bookTitle){
      	
       	$scope.currentBook.destroy({
	 success: function(myObject) {
		  // The object was deleted from the Parse Cloud.
		  alert("removed book");
  	},
  	error: function(myObject, error) {
    		// The delete failed.
    		// error is a Parse.Error with an error code and message.
    		alert("error removing book");

  		}
	});
      	
      	$scope.updateBooks();
      	alert("removed book: " + bookTitle);
      }
      $scope.removeImage = function(imageID){
      	
      	var Image = Parse.Object.extend("Image");
	var query = new Parse.Query(Image);
	query.get(imageID, {
  	success: function(foundImage) {
	 // The object was retrieved successfully.

	 foundImage.destroy({
	 success: function(myObject) {
		  // The object was deleted from the Parse Cloud.
		  alert("removed image");
  	},
  	error: function(myObject, error) {
    		// The delete failed.
    		// error is a Parse.Error with an error code and message.
    				  alert("error removing image");

  		}
	});
	 
	 },
  	error: function(object, error) {
    // The object was not retrieved successfully.
    // error is a Parse.Error with an error code and message.
  	}
	});
      	
      	
      
      }
      $scope.addBook = function() {
      	
      	
      	for (var i = 0; i < $scope.fixedBooks.length; i++) {
		if ($scope.fixedBooks[i].title == $scope.name)
			found = 1;
	}
      	
      	if (found){
      		alert("Book Already Exists, Upload Stopped");
      	}
      	else{
      	
      	var fileUploadControl = $("#pic")[0];
      	var parseFile;
      	$scope.fileName = $scope.cover.slice(12);
      	if (fileUploadControl.files.length > 0) {
	   var file = fileUploadControl.files[0];
   	   var name = $scope.fileName;
   	   parseFile = new Parse.File(name, file);
   	   alert("Uploaded: " + name);
      	}
      	
      	var found = 0;
      	
      	var Book= Parse.Object.extend("Book");
      	//var acl= new Parse.ACL();
	var book= new Book();
	//var user= new Parse.User();
	book.set("title",$scope.name);
	book.set("author",$scope.author);
	book.set("grade", $scope.pickedGrade);
	book.set("subject",$scope.pickedSubject);
	book.set("bookPhoto", parseFile);
	book.set("words",[]);
	book.set("images",[]);
	//user.setUsername("username", $scope.user);
	//acl.setPublicReadAccess(false);
	//acl.setPublicWriteAccess(false);
	//acl.setReadAccess(user, true);
	//acl.setWriteAccess(user, true);
	//window.alert(user.getUsername());
	//book.setACL(acl);
	book.save();
	$scope.fixedBooks.push({title:$scope.name,author:$scope.author,grade:$scope.grade});
      	}
      };
    }]);
       
       
// and fire it after definition
</script>
<script>
	
function activaTab(tab){
    $('.nav-tabs a[href="#' + tab + '"]').tab('show');
};




</script>


</head>

<body>







<div ng-controller="ExampleController">

	<div class="container">
		<div class="jumbotron">
			<h1 class="text-center"> Elloquent 2.4 </h1>
			<h3 class="text-center"> Quick Login Enabled, just click log in</h3>
		</div>	
	</div>

	<div class = "container" ng-hide="loggedIn == true">
        <input class="form-control"  type="text"  placeholder="Example: myUsername " ng-model="username" />
        <input class="form-control"  type="text"  placeholder="Example: myPassword " ng-model="password" />
	<input class="btn btn-primary btn-block" type="submit" id="passCode" value="Log In" ng-click="quickLogin()"  />
	</div>

	<div ng-show="loggedIn == true" data-ng-init="updateBooks()">

		<div class="container">
  		<h2>Navigation Bar</h2>
		<ul class="nav nav-tabs">
    			<li class="active"><a data-toggle="tab" href="#content">View Content</a></li>
    			<li><a data-toggle="tab" href="#home" ng-click="showme = false;">Books</a></li>
		 	<li><a data-toggle="tab" href="#menu1" ng-click="showme = false;">Words</a></li>
    			<li><a data-toggle="tab" href="#menu2" ng-click="showme = false;">Images</a></li>
  		</ul>


  		<div class="tab-content">
  		<div id="content" class="tab-pane fade in active">
      		<h3>View Content </h3>
      		
      		
      		
      		
      		
      		
      		
      		<div class="container">
      			<div class="col-sm-6">
      				
      				
      				<form class="form-inline">
  				<div class="form-group">
    					<label for="repeatSelect"> Filter by Grade: </label>
    					<select class="form-control" ng-model="filterGrades" ng-options="grade for grade in grades" ng-init="filterGrades = grades[0]">

    					</select>
    					
    					<label for="repeatSelect"> Filter by Subject: </label>
    					<select class="form-control" ng-model="filterSubjects" ng-options="subject for subject in subjects" ng-init="filterSubjects = subjects[0]">

    					</select>
  				</div>
  				<button type="submit" class="btn" id="filter" value="filter" ng-click = "filterBooks()" >Filter!</button>
  				<button type="submit" class="btn" id="resetFilter" value="restFilter" ng-click = "resetFilter()" >Reset Filter</button>
				</form>
      				
      				
      				
      				
      			
    			</div>
    		</div>
    		
    		<p></p>
    		
    		
    		
    		
    		
    		
    		
    		
      			<div class="container"  >
  				<table class="table table-hover">
  				
    				<tr>
    					
      					<th>Title</th>
      					<th>Author</th>
      					<th>Cover</th>
      					<th>Grade</th>
      					<th>Subject</th>
      				
      					<th>Jump to Edit</th>
					 </tr>
    				<tr ng-repeat="book in fixedBooks">
      					<td>{{book.title}}</td>
      					<td>{{book.author}}</td>
 
      					
      					<td><img ng-src="{{book.url}}" style="height:128px;" />	</td>
      					<td>{{book.grade}}</td>
      					<td>{{book.subject}}</td>	
      						
      				
      				
      				
      					<td>
      	  <button type="submit" class="btn" id="addWord" value="jumpWord" ng-click="trig(book)" >Add  Word!</button>
      	  <button type="submit" class="btn" id="addImage" value="jumpImage" ng-click="trig2(book)" >Add Image!</button>

      					</td>
      					
      					
      					
      					
			 		</tr>
  				</table>
			</div>
      		
      		</div>
    		<div id="home" class="tab-pane fade">
      			<h3>Add a Book</h3>
      
			 	<div class="container">
      				<h3>Book Title:</h3>
      				<input class="form-control"  type="text"  placeholder="Example: Harry Potter" ng-model="name" name="name2" />
      				<h3>Author:</h3>
      				<input class="form-control"  type="text"  placeholder="Example: J.K. Rowling" ng-model="author" />
    				<h3>Grade Level:</h3>
    				
    				
    				<label for="repeatSelect"> Pick Grade: </label>
    					<select class="form-control" ng-model="pickedGrade" ng-options="grade for grade in gradesPick">
    					<option value="">Select one</option>

    				</select>
    				
    				
      				<h3>Subject:</h3>
      				
      				<label for="repeatSelect"> Pick Subject: </label>
    				<select class="form-control" ng-model="pickedSubject" ng-options="subject for subject in subjectsPick">
    					<option value="">Select one</option>
      				</select>
      				
      				<h3>Username:</h3>
    			 	<input class="form-control"  type="text"  placeholder="Example: bronan" ng-model="user"/>
      				<h3>Book Cover:</h3>
      				<input type="file" id="pic" ng-model="cover"/>

      				<p></p>
      				<input class="btn btn-primary btn-block" type="submit" id="submit" value="Submit" ng-click="addBook()" ng-disabled="!name || !author || !pickedGrade || !user || !cover || !pickedSubject"/>
      

					<input class="btn btn-primary btn-block form-control" type="submit" id="hideBooks" value="Hide Books" ng-mouseover = "updateBooks()" ng-click="showme=false" ng-show = "showme"/>
        			<input class="btn btn-primary btn-block form-control" type="submit" id="key" value="Show Books" ng-mouseover = "updateBooks()" ng-click="showme=true" ng-hide = "showme"/>
				</div >
  


   	 
 
			<div class="container"  ng-show="showme">
  				<table class="table table-hover">
    				<tr>
      					<th>Title</th>
      					<th>Author</th>
      					<th>Remove Book</th>
					 </tr>
    				<tr ng-repeat="book in fixedBooks">
      					<td>{{book.title}}</td>
      					<td>{{book.author}}</td>
      					<td>
    						<button type="submit" class="btn" id="removeBook"  ng-click="removeBook(book.title)" >Remove Book</button>
					</td>
			 		</tr>
  				</table>
			</div>
      
      
    		</div>
    		
    		
    		<div id="menu1" class="tab-pane fade">
      			<h3>Add Words to a Book </h3>
      			
      			<div class="container">
      			<form class="form-inline">
  				<div class="form-group">
    					<label for="repeatSelect"> Pick Book: </label>
    					<select class="form-control" ng-model="selectedBook" ng-options="book.title for book in fixedBooks">
						<option value="">Select one</option>

    					</select>
    					
    		
  				</div>
  				<button type="submit" class="btn" id="updateWords" value="updateWords" ng-disabled = "!selectedBook" ng-click = "updateWords()" >Update Words</button>

			</form>
 			</div>
 
 
 
 

   	 
 
			

				<div class = "container">
					<h3>Add Word:</h3>
		   			<input class="form-control"  type="text"  placeholder="Example: Technology" ng-model="word"/>
		     	 	<input class="btn btn-primary btn-block" type="submit" id="addWord" value="Add Word" ng-click="addWord()" ng-disabled="!word || !selectedBook.title"/>
					<input class="btn btn-primary btn-block form-control" type="submit" id="hide" ng-mouseover = "updateWords()" value="Hide Words" ng-click="showmeWords=false;updateWords(); " ng-show = "showmeWords"/>
					<input class="btn btn-primary btn-block form-control" type="submit" id="key" ng-mouseover = "updateWords()" value="Show Words" ng-click="showmeWords=true;updateWords();" ng-hide = "showmeWords"/ ng-disabled="!selectedBook.title">
				</div>

				<div class="container"  ng-show="showmeWords">
  					<table class="table table-hover">
    					<tr>
      						<th>Words</th>
      						<th>Remove Word</th>
		 			</tr>
		 			
    				<tr ng-repeat="word in wordList track by $index">
      					<td>{{word}}</td>
      					<td>      	
      					<button type="submit" class="btn" id="removeWord"  ng-click="removeWord(word)" >Remove Word</button>
					</td>
    				</tr>
    				</table>
    				
    				

	 		</div>
	 		</div>
	 		
	 		<div id="menu2" class="tab-pane fade">
      				<h3>Add Images to a Book</h3>
      				
      			<div class="container">
      			<form class="form-inline">
  				<div class="form-group">
    					<label for="repeatSelect"> Pick Book: </label>
    					<select class="form-control" ng-model="selectedBook" ng-options="book.title for book in fixedBooks">
						<option value="">Select one</option>

    					</select>
    					
    		
  				</div>
  				<button type="submit" class="btn" id="updateImages" value="updateImages" ng-disabled = "!selectedBook" ng-click = "updateImages()" >Update Images</button>

			</form>
 			</div>

      				

   	 
 
			

				<div class = "container">
					<h3>Add Image:</h3>
		     	 		<input  type="file" id="image" ng-model="image"/>
		     	 		<input class="btn btn-primary btn-block" type="submit" id="addImage" value="Add Image" ng-click="addImage()" ng-disabled="!image"/>
		     	 		<input class="btn btn-primary btn-block form-control" type="submit" id="hideImage" value="Hide Images" ng-mouseover = "updateImages()" ng-click="showmeImages=false;updateImages(); " ng-show = "showmeImages"/>
					<input class="btn btn-primary btn-block form-control" type="submit" id="showImage" value="Show Images"  ng-mouseover = "updateImages()" ng-click="showmeImages=true;updateImages();" ng-hide = "showmeImages"/ ng-disabled="!selectedBook.title">


				</div>
				
				<div class = "container" ng-show="showmeImages">
					<h3>Images:</h3>
					<div class="container">
  					<table class="table table-hover">
    					<tr>
    						<th>Name</th>
      						<th>Image</th>
      						<th>Remove Image</th>
		 					</tr>
    					<tr ng-repeat="image in imageList track by $index" >
    						<td>{{image.name}} </td>
    						<td><img ng-src="{{image.url}}" style="height:128px;" />	</td>
    						<td>
    							<button type="submit" class="btn" id="removeImage"  ng-click="removeImage(image.id)" >Remove Image</button>
						</td>
    					</tr>
  					</table>


				</div>
				</div>

			
      				
      				
    		</div>
    
   		</div>

		</div>
	</div>
</div>





</body>
</html>
