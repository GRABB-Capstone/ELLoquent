<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <!--<base href="/">-->

    <script src="https://npmcdn.com/parse@1.9.2/dist/parse.min.js"></script>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.5/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

    <script>
        Parse.initialize("hm3HmqcHxgfMQxP2SF0Ue0at67HFqqxeYq5ZxKoR", "nweYdxbTDxFnWp85o2xxqNu6Gl8zDKnaZyxGWkAe");
        Parse.serverURL = 'https://parseapi.back4app.com'
    </script>

    <style>
        .login-header-container {
            background-color: rgb(92, 184, 228);
            /*border-bottom: solid;*/
            /*border-bottom-color: gray;
            border-bottom-width: 2px;*/
            border-radius: 8px;
        }

        .login-container {
            /*border: solid;*/
            /*border-color: gray;
            border-width: 2px;*/
            border-radius: 8px;
            background-color: rgb(170, 225, 255);
            padding: 0px;
        }
    </style>

    <script>

        angular.module('submitExample', []).controller('ExampleController', ['$scope', function ($scope) {

        }]);

    </script>
</head>

<body>
    <div ng-controller="ExampleController">

        <div class="container">
            <!-- Modal -->
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">Warning!</h4>
                        </div>
                        <div class="modal-body">
                            <h2> Are you sure you want to delete this book and erase its content?</h2>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="removeBook(selectedBook)">Delete Book</button>
                        </div>
                    </div>
                </div>
            </div>
            <center><img src="images/elloquent_whitespace.png" alt="hi" style="height:128px" class="inline" /></center>
        </div>

        <div class="container" style="padding-top: 15px;" ng-hide="loggedIn == true">
            <div class="login-container" style="width: 40%; margin: 0 auto;">
                <div class="login-header-container" style="font-size: 40px; text-align: center;">Log In</div>
                <div style="padding: 10px;">
                    <input class="form-control" type="text" placeholder="Username" id="test" ng-model="username" />
                    <input class="form-control" style="margin-top: 15px;" type="text" placeholder="Password" ng-model="password" />
                    <input href="#Header" class="btn btn-primary btn-block" style="margin-top: 15px;" type="submit" id="passCode" value="Log In" ng-click="login()" ng-disabled="!username || !password" />
                </div>
            </div>
        </div>

        <div ng-show="loggedIn == true">

            <div class="container">

                <div class="row">
                    <span class="right">
                        <input class="btn btn-primary" type="submit" id="logout" value="Log Out" ng-click="logout()" />
                    </span>
                    <span class="left">
                        <h2>Welcome {{currentUser.get('username')}}</h2>
                    </span>
                </div>

                <div class="row">
                    <ul class="nav nav-tabs">
                        <li class="active"><a data-toggle="tab" href="#content" id="myTab" ng-click="filterBooks()">Browse Content</a></li>
                        <li><a data-toggle="tab" href="#home" ng-click="refreshAddBooks()">Add Books</a></li>
                        <li id="editBook"><a data-toggle="tab" href="#menu1">Edit Book</a></li>
                        <li><a data-toggle="tab" href="#menu2">My Books</a></li>
                    </ul>
                </div>

                <div class="row">
                    <div class="tab-content">
                        <div id="content" class="tab-pane fade in active">
                            <h3>Browse Content </h3>

                            <div class="container">

                                <div class="row">
                                    <div class="col-sm-4">
                                        <form>
                                            <div class="form-group">
                                                <label for="repeatSelect"> Filter by Grade: </label>
                                                <select class="form-control" ng-model="filterGrades" ng-options="grade for grade in grades" ng-init="filterGrades = grades[0]"></select>
                                                <label for="repeatSelect"> Filter by Subject: </label>
                                                <select class="form-control" ng-model="filterSubjects" ng-options="subject for subject in subjects" ng-init="filterSubjects = subjects[0]"></select>
                                            </div>
                                            <button type="submit" class="btn" id="filter" value="filter" ng-click="filterBooks()">Filter!</button>
                                            <button type="submit" class="btn" id="resetFilter" value="restFilter" ng-click="resetFilter()">Reset Filter</button>
                                        </form>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="mygrid-wrapper-div">

                                        <table class="table table-hover">
                                            <tr>
                                                <th>Title</th>
                                                <th>Author</th>
                                                <th>Cover</th>
                                                <th>Grade</th>
                                                <th>Subject</th>
                                                <th>Edit</th>
                                                <th>Add to User</th>
                                            </tr>
                                            <tr ng-repeat="book in allBooks">
                                                <td>{{book.get("title")}}</td>
                                                <td>{{book.get("author")}}</td>
                                                <td><img ng-src="{{book.get('bookPhoto').url()}}" style="width:192px;" />	</td>
                                                <td>{{book.get("grade")}}</td>
                                                <td>{{book.get("subject")}}</td>
                                                <td><button type="submit" class="btn" id="addWord" value="jumpWord" ng-click="trig(book)">Edit</button></td>
                                                <td><button type="submit" class="btn" id="addToUser" ng-click="addToUser(book)">Add to User</button></td>
                                            </tr>
                                        </table>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="home" class="tab-pane fade">

                            <h3>Add a Book</h3>

                            <div class="container">
                                <form name="bookAddForm">

                                    <div class="row">
                                        <div class="col-md-6">

                                            <h5>Title:</h5>
                                            <input type="text" class="form-control" name="name" ng-class="{ 'error': attempted && bookAddForm.name.$invalid }" ng-model="name" required placeholder="Example: Harry Potter" />

                                            <h5>Author:</h5>
                                            <input type="text" class="form-control" name="author" ng-class="{ 'error': attempted && bookAddForm.author.$invalid }" ng-model="author" required placeholder="Example: J. K. Rowling" />

                                            <h5>Select Subject:</h5>
                                            <select name="subj" class="form-control" ng-class="{'error':attempted && bookAddForm.subj.$invalid}" style="width: 220px;"
                                                    ng-model="pickedSubject"
                                                    ng-options="subject for subject in subjectsPick"
                                                    required>
                                                <option value="">Select Subject</option>
                                            </select>
                                            <h5>Select Grade:</h5>
                                            <select name="grade" class="form-control" ng-class="{'error':attempted &&  bookAddForm.grade.$invalid}" style="width: 220px;"
                                                    ng-model="pickedGrade"
                                                    ng-options="grade for grade in gradesPick"
                                                    required>
                                                <option value="">Select Grade</option>
                                            </select>

                                            <input class="btn btn-primary btn-block" type="submit" id="submit" value="Submit" ng-click="validateBook()" />

                                        </div>

                                        <div class="col-md-6">

                                            <h5>Book Cover:</h5>
                                            <center>
                                                <img id="imageCover" ng-src="{{defaultImage}}" style="height:192px" />
                                            </center>
                                            <input type="file" id="imageFile" name="cover" ng-class="{'error':attempted  && bookAddForm.cover.$invalid}" ng-model="cover" required />

                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <div id="menu1" class="tab-pane fade">
                            <div class="container">

                                <div class="row">
                                    <div class=col-md-4>
                                        <div class="col-md-12">
                                            <div class="row">
                                                <h3>Edit Book Details </h3>

                                                <form name="editForm">

                                                    <h5>Book Cover:</h5>
                                                    <img id="editImageCover" ng-src="{{selectedBook.get('bookPhoto').url()}}" style="width:192px;" />
                                                    <input id="editImageFile" type="file" ng-model="editCover" />

                                                    <h5>Book Title:</h5>
                                                    <input class="form-control" name="editName" ng-class="{ 'error': editForm.editName.$invalid }" type="text" ng-model="editName" required />
                                                    <h5>Author:</h5>
                                                    <input class="form-control" name="editAuthor" ng-class="{ 'error': editForm.editAuthor.$invalid }" type="text" ng-model="editAuthor" required />
                                                    
                                                    <h5>Select Grade Level:</h5>
                                                    <select class="form-control" ng-model="editPickedGrade" ng-options="grade for grade in gradesPick"></select>

                                                    <h5>Select Subject:</h5>
                                                    <select class="form-control" ng-model="editPickedSubject" ng-options="subject for subject in subjectsPick"></select>

                                                    <input class="btn btn-primary btn-block" type="submit" id="submit" value="Save Book Details" ng-click="editBook()" ng-disabled="!editName || !editAuthor || !editPickedGrade || !editPickedSubject" />

                                                    <!-- Button trigger modal -->
                                                    <button type="button" class="btn btn-danger btn-block" data-toggle="modal" data-target="#myModal" ng-disabled="!selectedBook">
                                                        Delete Book
                                                    </button>

                                                    <input class="btn btn-warning btn-block" type="submit" id="backToBrowse" value="Cancel Edit" ng-click="jumpToBrowse();" />
                                                </form>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <div class="col-md-12">

                                            <div class="row">
                                                <h3>Current Words </h3>

                                                <h5>Add Word:</h5>
                                                <input class="form-control" type="text" placeholder="Example: Technology" ng-model="word" />
                                                <input class="btn btn-primary btn-block" type="submit" id="addWord" value="Add Word" ng-click="addWord()" ng-disabled="!word || !selectedBook" />
                                            </div>

                                            <div class="row">
                                                <div class="mygrid-wrapper-div">
                                                    <table class="table table-hover">
                                                        <tr>
                                                            <th>Words</th>
                                                            <th>Remove</th>
                                                        </tr>

                                                        <tr ng-repeat="word in selectedBook.get('words') track by $index">
                                                            <td>{{word}}</td>
                                                            <td>
                                                                <button type="submit" class="btn" id="removeWord" ng-click="removeWord(word)">X</button>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <div class="col-md-12">

                                            <div class="row">
                                                <h3>Current Images</h3>

                                                <h5>Add Image:</h5>
                                                <input class="form-control" type="file" id="image" ng-model="image" />
                                                <input class="btn btn-primary btn-block" type="submit" id="addImage" value="Add Image" ng-click="addImage()" ng-disabled="!image||  !selectedBook" />
                                            </div>

                                            <div class="row">
                                                <div class="mygrid-wrapper-div">
                                                    <table class="table table-hover">
                                                        <tr>
                                                            <th>Image</th>
                                                            <th>Remove</th>
                                                        </tr>
                                                        <tr ng-repeat="im in selectedBook.get('images')">
                                                            <td><img ng-src="{{im}}" style="width:192px;" />	</td>
                                                            <td>
                                                                <button type="submit" class="btn" id="removeImage" ng-click="removeImage(im)">X</button>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="menu2" class="tab-pane fade">
                            <h3>Your Books!</h3>

                            <div class="container">

                                <div class="row">
                                    <div class="col-sm-4">
                                        <form>
                                            <div class="form-group">
                                                <label for="repeatSelect"> Filter by Grade: </label>
                                                <select class="form-control" ng-model="myFilterGrades" ng-options="grade for grade in grades" ng-init="myFilterGrades = grades[0]"></select>

                                                <label for="repeatSelect"> Filter by Subject: </label>
                                                <select class="form-control" ng-model="myFilterSubjects" ng-options="subject for subject in subjects" ng-init="myFilterSubjects = subjects[0]"></select>
                                            </div>
                                            <button type="submit" class="btn" id="filter" value="filter" ng-click="myFilterBooks()">Filter!</button>
                                            <button type="submit" class="btn" id="resetFilter" value="restFilter" ng-click="myResetFilter()">Reset Filter</button>
                                        </form>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="mygrid-wrapper-div">
                                        <p></p>
                                        <p></p>
                                        <table class="table table-hover">
                                            <tr>
                                                <th>Title</th>
                                                <th>Author</th>
                                                <th>Cover</th>
                                                <th>Grade</th>
                                                <th>Subject</th>
                                                <th>Edit</th>
                                                <th>Remove from User</th>
                                            </tr>
                                            <tr ng-repeat="book in userBooks">
                                                <td>{{book.get("title")}}</td>
                                                <td>{{book.get("author")}}</td>
                                                <td><img ng-src="{{book.get('bookPhoto').url()}}" style="width:192px;" />	</td>
                                                <td>{{book.get("grade")}}</td>
                                                <td>{{book.get("subject")}}</td>
                                                <td><button type="submit" class="btn" id="addWord" value="jumpWord" ng-click="trig(book)">Edit</button></td>
                                                <td><button type="submit" class="btn" id="addToUser" ng-click="removeFromUser(book)">Remove from User</button></td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
</html>